<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="This is an annotated implementation/tutorial of Regret Minimization in Games with Incomplete Information"/>

    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:image:src" content="https://avatars1.githubusercontent.com/u/64068543?s=400&amp;v=4"/>
    <meta name="twitter:title" content="Regret Minimization in Games with Incomplete Information"/>
    <meta name="twitter:description" content="This is an annotated implementation/tutorial of Regret Minimization in Games with Incomplete Information"/>
    <meta name="twitter:site" content="@labmlai"/>
    <meta name="twitter:creator" content="@labmlai"/>

    <meta property="og:url" content="https://nn.labml.ai/cfr/index.html"/>
    <meta property="og:title" content="Regret Minimization in Games with Incomplete Information"/>
    <meta property="og:image" content="https://avatars1.githubusercontent.com/u/64068543?s=400&amp;v=4"/>
    <meta property="og:site_name" content="LabML Neural Networks"/>
    <meta property="og:type" content="object"/>
    <meta property="og:title" content="Regret Minimization in Games with Incomplete Information"/>
    <meta property="og:description" content="This is an annotated implementation/tutorial of Regret Minimization in Games with Incomplete Information"/>

    <title>Regret Minimization in Games with Incomplete Information</title>
    <link rel="shortcut icon" href="/icon.png"/>
    <link rel="stylesheet" href="../pylit.css">
    <link rel="canonical" href="https://nn.labml.ai/cfr/index.html"/>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4V3HC8HBLH"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-4V3HC8HBLH');
    </script>
</head>
<body>
<div id='container'>
    <div id="background"></div>
    <div class='section'>
        <div class='docs'>
            <p>
                <a class="parent" href="/">home</a>
                <a class="parent" href="index.html">cfr</a>
            </p>
            <p>

                <a href="https://github.com/lab-ml/labml_nn/tree/master/labml_nn/cfr/__init__.py">
                    <img alt="Github"
                         src="https://img.shields.io/github/stars/lab-ml/nn?style=social"
                         style="max-width:100%;"/></a>
                <a href="https://twitter.com/labmlai"
                   rel="nofollow">
                    <img alt="Twitter"
                         src="https://img.shields.io/twitter/follow/labmlai?style=social"
                         style="max-width:100%;"/></a>
            </p>
        </div>
    </div>
    <div class='section' id='section-0'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-0'>#</a>
                </div>
                <h1>Regret Minimization in Games with Incomplete Information</h1>
<p>The paper
<a href="http://martin.zinkevich.org/publications/regretpoker.pdf">Regret Minimization in Games with Incomplete Information</a>
introduces notion counterfactual regret and how minimizing counterfactual regret through self-play
can be used to reach Nash equilibrium.
The paper uses this technique to solve Texas Hold&rsquo;em Poker.</p>
<p>We tried to keep our Python implementation easy-to-understand like a tutorial; therefore
it is not very efficient.
We run it on <a href="kuhn.html">a very simple imperfect information game called Kuhn poker</a>.</p>
<h2>Introduction</h2>
<p>Counterfactual Regret minimization, in each iteration,
 explores the full game tree by trying all player actions.
It samples chance events only once per iteration.
Chance events are things like dealing cards; they are kept constant for each game tree exploration.
Then it calculates the <em>regret</em> of not taking each action, and following the current strategy.
Then it updates the strategy based on these regrets for the next iteration.
Finally it computes the average of the strategies throughout the iterations.
This becomes very close to the Nash equilibrium.</p>
<p>We will first introduce the mathematical notation and theory.
It was difficult to have the theory introduced in-line with code.</p>
<h3>Player</h3>
<p>A player is denoted by $i \in N$, where $N$ is the set of players.</p>
<h3><a href="#History">History</a></h3>
<p>History $h \in H$ is a sequence of actions including chance events,
 and $H$ is the set of all histories.</p>
<p>$Z \subseteq H$ is the set of of terminal histories (game over).</p>
<h3>Action</h3>
<p>Action $a$, $A(h) = {a: (h, a) \in H}$ where $h \in H$ is a non-terminal <a href="#History">history</a>.</p>
<h3><a href="#InfoSet">Information Set $I_i$</a></h3>
<p><strong>Information set</strong> $I_i \in \mathcal{I}_i$ for player $i$
is a similar to a history $h \in H$
but only contain the actions visible to player $i$.
That is, the history $h$ will contain actions/event such as cards dealt to the
opposing player while $I_i$ will not have them.</p>
<p>$\mathcal{I}_i$ is known as the <strong>information partition</strong> of player $i$.</p>
<p><a id="Strategy"></a></p>
<h3>Strategy</h3>
<p><strong>Strategy of player</strong> $i$, $\sigma_i \in \Sigma_i$ is a distribution over actions $A(I_i)$,
where $\Sigma_i$ is the set of all strategies for player $i$.
Strategy on $t$-th iteration is denoted by $\sigma^t_i$.</p>
<p>Strategy is defined as a probability for taking an action $a$ in for a given information set $I$,</p>
<p>
<script type="math/tex; mode=display">\sigma_i(I)(a)</script>
</p>
<p>$\sigma$ is the <strong>strategy profile</strong> which consists of strategies of all players
 $\sigma_1, \sigma_2, \ldots$</p>
<p>$\sigma_{-i}$ is strategies of all players except $\sigma_i$</p>
<p><a id="HistoryProbability"></a></p>
<h3>Probability of History</h3>
<p>$\pi^\sigma(h)$ is the probability of reaching the history $h$ with strategy profile $\sigma$.
$\pi^\sigma(h)_{-i}$ is the probability of reaching $h$ without player $i$&rsquo;s contribution;
 i.e. player $i$ took the actions to follow $h$ with a probability of $1$.</p>
<p>
<script type="math/tex; mode=display">\pi^\sigma(I) = \sum_{h \in I} \pi^\sigma(h)</script>
</p>
<p>for information set $I$, is the probability of reaching information set $I$ with
strategy profile $\sigma$.</p>
<h3>Utility (Pay off)</h3>
<p>The <a href="#terminal_utility">terminal utility</a> is the utility (or pay off)
 of a player $i$ for a terminal history $h$.</p>
<p>
<script type="math/tex; mode=display">u_i(h)</script> where $h \in Z$</p>
<p>$u_i(\sigma)$ is the expected utility (payoff) for player $i$ with strategy profile $\sigma$.</p>
<p>
<script type="math/tex; mode=display">u_i(\sigma) = \sum_{h \in Z} u_i(h) \pi^\sigma(h)</script>
</p>
<h3>Nash Equilibrium</h3>
<p>Nash equilibrium is state where none of the players can increase their expected utility (or payoff)
by changing her strategy alone.</p>
<p>For two players, Nash equilibrium is a <a href="#Strategy">strategy profile</a> where</p>
<p>
<script type="math/tex; mode=display">\begin{align}
u_1(\sigma) &\ge \max_{\sigma'_1 \in \Sigma_1} u_1(\sigma'_1, \sigma_2) \\
u_2(\sigma) &\ge \max_{\sigma'_2 \in \Sigma_2} u_1(\sigma_1, \sigma'_2) \\
\end{align}</script>
</p>
<p>$\epsilon$-Nash equilibrium is,</p>
<p>
<script type="math/tex; mode=display">\begin{align}
u_1(\sigma) + \epsilon &\ge \max_{\sigma'_1 \in \Sigma_1} u_1(\sigma'_1, \sigma_2) \\
u_2(\sigma)  + \epsilon &\ge \max_{\sigma'_2 \in \Sigma_2} u_1(\sigma_1, \sigma'_2) \\
\end{align}</script>
</p>
<h3>Regret Minimization</h3>
<p>Regret is the utility (or pay off) that the player didn&rsquo;t get because
 she didn&rsquo;t follow the optimal strategy or took the best action.</p>
<p>Average overall regret for Player $i$ is, the average regret of not following the
optimal strategy in all $T$ rounds of game play.</p>
<p>
<script type="math/tex; mode=display">R^T_i = \frac{1}{T} \max_{\sigma^*_i \in \Sigma_i} \sum_{t=1}^T
\Big( u_i(\sigma^*_i, \sigma^t_{-i}) - u_i(\sigma^t) \Big)</script>
</p>
<p>where $\sigma^t$ is the strategy profile of all players in round $t$,
and</p>
<p>
<script type="math/tex; mode=display">(\sigma^*_i, \sigma^t_{-i})</script>
</p>
<p>is the strategy profile $\sigma^t$ with player $i$&rsquo;s strategy
replaced with $\sigma^*_i$.</p>
<p>The average strategy is the average of strategies followed in each round,
 for all $I \in \mathcal{I}, a \in A(I)$</p>
<p>
<script type="math/tex; mode=display">\bar{\sigma}^T_i(I)(a) = \frac{\sum_{t=1}^T \pi_i^{\sigma^t}(I)\sigma^t(I)(a)}{\sum_{t=1}^T \pi_i^{\sigma^t}(I)}</script>
</p>
<p>That is the mean regret of not playing with the optimal strategy.</p>
<p>If $R^T_i &lt; \epsilon$ for all players then $\bar{\sigma}^T_i(I)(a)$ is a
$2\epsilon$-Nash equilibrium.</p>
<p>
<script type="math/tex; mode=display">\begin{align}
R^T_i &< \epsilon \\
R^T_i &= \frac{1}{T} \max_{\sigma^*_i \in \Sigma_i} \sum_{t=1}^T
\Big( u_i(\sigma^*_i, \sigma^t_{-i}) - u_i(\sigma^t) \Big) \\
&= \frac{1}{T} \max_{\sigma^*_i \in \Sigma_i} \sum_{t=1}^T u_i(\sigma^*_i, \sigma^t_{-i})
- \frac{1}{T} \sum_{t=1}^T u_i(\sigma^t) < \epsilon
\end{align}</script>
</p>
<p>Since $u_1 = -u_2$ because it&rsquo;s a zero-sum game, we can add $R^T_1$ and $R^T_i$ and the
second term will cancel out.</p>
<p>
<script type="math/tex; mode=display">\begin{align}
2\epsilon &>
\frac{1}{T} \max_{\sigma^*_1 \in \Sigma_1} \sum_{t=1}^T u_1(\sigma^*_1, \sigma^t_{-1}) +
\frac{1}{T} \max_{\sigma^*_2 \in \Sigma_2} \sum_{t=1}^T u_2(\sigma^*_2, \sigma^t_{-2})
\end{align}</script>
</p>
<p>The average of utilities over a set of strategies is equal to the utility of the average strategy.</p>
<p>
<script type="math/tex; mode=display">\frac{1}{T} \sum_{t=1}^T u_i(\sigma^t) = u_i(\bar{\sigma}^T)</script>
</p>
<p>Therefore,
<script type="math/tex; mode=display">\begin{align}
2\epsilon &>
\max_{\sigma^*_1 \in \Sigma_1} u_1(\sigma^*_1, \bar{\sigma}^T_{-1}) +
\max_{\sigma^*_2 \in \Sigma_2} u_2(\sigma^*_2, \bar{\sigma}^T_{-2})
\end{align}</script>
</p>
<p>From definition of $\max$,
<script type="math/tex; mode=display">\max_{\sigma^*_2 \in \Sigma_2} u_2(\sigma^*_2, \bar{\sigma}^T_{-2}) \ge u_2(\bar{\sigma}^T)
 = -u_1(\bar{\sigma}^T)</script>
</p>
<p>Then,
<script type="math/tex; mode=display">\begin{align}
2\epsilon &>
\max_{\sigma^*_1 \in \Sigma_1} u_1(\sigma^*_1, \bar{\sigma}^T_{-1}) +
-u_1(\bar{\sigma}^T) \\
u_1(\bar{\sigma}^T) + 2\epsilon &> \max_{\sigma^*_1 \in \Sigma_1} u_1(\sigma^*_1, \bar{\sigma}^T_{-1})
\end{align}</script>
</p>
<p>That is, $2\epsilon$-Nash equilibrium. You can similarly prove for games with more than 2 players.</p>
<p>So we need to minimize $R^T_i$ to get close to a Nash equilibrium.</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">190</span><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NewType</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">cast</span><span class="p">,</span> <span class="n">Optional</span>
<span class="lineno">191</span>
<span class="lineno">192</span><span class="kn">from</span> <span class="nn">labml</span> <span class="kn">import</span> <span class="n">monit</span><span class="p">,</span> <span class="n">tracker</span><span class="p">,</span> <span class="n">logger</span>
<span class="lineno">193</span><span class="kn">from</span> <span class="nn">labml.configs</span> <span class="kn">import</span> <span class="n">BaseConfigs</span><span class="p">,</span> <span class="n">option</span>
<span class="lineno">194</span><span class="kn">from</span> <span class="nn">labml_helpers.training_loop</span> <span class="kn">import</span> <span class="n">TrainingLoop</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-1'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-1'>#</a>
                </div>
                <p>A player $i \in N$ where $N$ is the set of players</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">197</span><span class="n">Player</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s1">&#39;Player&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-2'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-2'>#</a>
                </div>
                <p>Action $a$, $A(h) = {a: (h, a) \in H}$ where $h \in H$ is a non-terminal <a href="#History">history</a></p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">199</span><span class="n">Action</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s1">&#39;Action&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-3'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-3'>#</a>
                </div>
                <p><a id="History"></a></p>
<h2>History</h2>
<p>History $h \in H$ is a sequence of actions including chance events,
 and $H$ is the set of all histories.</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">202</span><span class="k">class</span> <span class="nc">History</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-4'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-4'>#</a>
                </div>
                <p>Whether it&rsquo;s a terminal history; i.e. game over.
$h \in Z$</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">211</span>    <span class="k">def</span> <span class="nf">is_terminal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-5'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-5'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">216</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-6'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-6'>#</a>
                </div>
                <p><a id="terminal_utility"></a>
Utility of player $i$ for a terminal history.
$u_i(h)$ where $h \in Z$</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">218</span>    <span class="k">def</span> <span class="nf">terminal_utility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Player</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-7'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-7'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">224</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-8'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-8'>#</a>
                </div>
                <p>Get current player, denoted by $P(h)$, where $P$ is known as <strong>Player function</strong>.</p>
<p>If $P(h) = c$ it means that current event is a chance $c$ event.
Something like dealing cards, or opening common cards in poker.</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">226</span>    <span class="k">def</span> <span class="nf">player</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Player</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-9'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-9'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">233</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-10'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-10'>#</a>
                </div>
                <p>Whether the next step is a chance step; something like dealing a new card.
$P(h) = c$</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">235</span>    <span class="k">def</span> <span class="nf">is_chance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-11'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-11'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">240</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-12'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-12'>#</a>
                </div>
                <p>Sample a chance when $P(h) = c$.</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">242</span>    <span class="k">def</span> <span class="nf">sample_chance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Action</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-13'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-13'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">246</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-14'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-14'>#</a>
                </div>
                <p>Add an action to the history.</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">248</span>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">Action</span><span class="p">):</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-15'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-15'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">252</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-16'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-16'>#</a>
                </div>
                <p>Get <a href="#InfoSet">information set</a> for the current player</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">254</span>    <span class="k">def</span> <span class="nf">info_set_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-17'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-17'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">258</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-18'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-18'>#</a>
                </div>
                <p>Create a new <a href="#InfoSet">information set</a> for the current player</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">260</span>    <span class="k">def</span> <span class="nf">new_info_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;InfoSet&#39;</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-19'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-19'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">264</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-20'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-20'>#</a>
                </div>
                <p>Human readable representation</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">266</span>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-21'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-21'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">270</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-22'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-22'>#</a>
                </div>
                <p><a id="InfoSet"></a></p>
<h2>Information Set $I_i$</h2>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">272</span><span class="k">class</span> <span class="nc">InfoSet</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-23'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-23'>#</a>
                </div>
                <p>Unique key identifying the information set</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">279</span>    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-24'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-24'>#</a>
                </div>
                <p>$\sigma_i$, the strategy of player $i$</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">281</span>    <span class="n">strategy</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-25'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-25'>#</a>
                </div>
                <p>Current regret of not taking each action $A(I_i)$,</p>
<p>
<script type="math/tex; mode=display">\pi^{\sigma^t}_{-i} (I) \Big( u_i(\sigma_t |_{I \rightarrow a}, I) - u_i(\sigma^t, I) \Big)</script>
where $\sigma_t |_{I \rightarrow a}$ is the same as strategy $\sigma_t$ but always taking action $a$
at $I$.</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">287</span>    <span class="n">current_regret</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-26'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-26'>#</a>
                </div>
                <p>Total regret of not taking each action $A(I_i)$,</p>
<p>
<script type="math/tex; mode=display">R^T_i(I, a) = \frac{1}{T} \sum_{t=1}^T
\pi^{\sigma^t}_{-i} (I) \Big( u_i(\sigma_t |_{I \rightarrow a}, I) - u_i(\sigma^t, I) \Big)</script>
</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">292</span>    <span class="n">regret</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-27'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-27'>#</a>
                </div>
                <p>Average strategy</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">294</span>    <span class="n">average_strategy</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-28'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-28'>#</a>
                </div>
                <p>Initialize</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">296</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-29'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-29'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">300</span>        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
<span class="lineno">301</span>        <span class="bp">self</span><span class="o">.</span><span class="n">regret</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">()}</span>
<span class="lineno">302</span>        <span class="bp">self</span><span class="o">.</span><span class="n">current_regret</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">()}</span>
<span class="lineno">303</span>        <span class="bp">self</span><span class="o">.</span><span class="n">average_strategy</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">()}</span>
<span class="lineno">304</span>        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_strategy</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-30'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-30'>#</a>
                </div>
                <p>Actions $A(I_i)$</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">306</span>    <span class="k">def</span> <span class="nf">actions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Action</span><span class="p">]:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-31'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-31'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">310</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-32'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-32'>#</a>
                </div>
                <p>Load information set from a saved dictionary</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">312</span>    <span class="nd">@staticmethod</span>
<span class="lineno">313</span>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;InfoSet&#39;</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-33'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-33'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">317</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-34'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-34'>#</a>
                </div>
                <p>Save the information set to a dictionary</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">319</span>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-35'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-35'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">323</span>        <span class="k">return</span> <span class="p">{</span>
<span class="lineno">324</span>            <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
<span class="lineno">325</span>            <span class="s1">&#39;regret&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">regret</span><span class="p">,</span>
<span class="lineno">326</span>            <span class="s1">&#39;average_strategy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_strategy</span><span class="p">,</span>
<span class="lineno">327</span>        <span class="p">}</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-36'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-36'>#</a>
                </div>
                <p>Load data from a saved dictionary</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">329</span>    <span class="k">def</span> <span class="nf">load_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]):</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-37'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-37'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">333</span>        <span class="bp">self</span><span class="o">.</span><span class="n">regret</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;regret&#39;</span><span class="p">]</span>
<span class="lineno">334</span>        <span class="bp">self</span><span class="o">.</span><span class="n">average_strategy</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;average_strategy&#39;</span><span class="p">]</span>
<span class="lineno">335</span>        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_strategy</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-38'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-38'>#</a>
                </div>
                <h2>Calculate strategy</h2>
<p>Strategy of time $T + 1$ is,</p>
<p>
<script type="math/tex; mode=display">\begin{align}
\sigma_i^{T+1}(I)(a) =
\begin{cases}
\frac{R^{T,+}_i(I, a)}{\sum_{a'\in A(I)}R^{T,+}_i(I, a')},  & \text{if} \sum_{a'\in A(I)}R^{T,+}_i(I, a') \gt 0 \\
\frac{1}{\lvert A(I) \rvert}, & \text{otherwise}
\end{cases}
\end{align}</script>
</p>
<p>where $R^{T,+}_i(I, a) = \max \Big(R^T_i(I, a), 0 \Big)$</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">337</span>    <span class="k">def</span> <span class="nf">calculate_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-39'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-39'>#</a>
                </div>
                <p>
<script type="math/tex; mode=display">R^{T,+}_i(I, a) = \max \Big(R^T_i(I, a), 0 \Big)</script>
</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">354</span>        <span class="n">regret</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">regret</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-40'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-40'>#</a>
                </div>
                <p>
<script type="math/tex; mode=display">\sum_{a'\in A(I)}R^{T,+}_i(I, a')</script>
</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">356</span>        <span class="n">regret_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">regret</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-41'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-41'>#</a>
                </div>
                <p>if $\sum_{a&rsquo;\in A(I)}R^{T,+}_i(I, a&rsquo;) \gt 0$</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">358</span>        <span class="k">if</span> <span class="n">regret_sum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-42'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-42'>#</a>
                </div>
                <p>\frac{R^{T,+}<em>i(I, a)}{\sum</em>{a&rsquo;\in A(I)}R^{T,+}_i(I, a&rsquo;)}</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">360</span>            <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="n">r</span> <span class="o">/</span> <span class="n">regret_sum</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">regret</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-43'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-43'>#</a>
                </div>
                <p>Otherwise</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">362</span>        <span class="k">else</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-44'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-44'>#</a>
                </div>
                <p>$\lvert A(I) \rvert$</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">364</span>            <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">regret</span><span class="p">))</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-45'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-45'>#</a>
                </div>
                <p>$\frac{1}{\lvert A(I) \rvert}$</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">366</span>            <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">count</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">regret</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-46'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-46'>#</a>
                </div>
                <h2>Get normalized average strategy</h2>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">368</span>    <span class="k">def</span> <span class="nf">get_average_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-47'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-47'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">372</span>        <span class="n">cum_strategy</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_strategy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">()}</span>
<span class="lineno">373</span>        <span class="n">strategy_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cum_strategy</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="lineno">374</span>        <span class="k">if</span> <span class="n">strategy_sum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="lineno">375</span>            <span class="k">return</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="n">s</span> <span class="o">/</span> <span class="n">strategy_sum</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cum_strategy</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="lineno">376</span>        <span class="k">else</span><span class="p">:</span>
<span class="lineno">377</span>            <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cum_strategy</span><span class="p">))</span>
<span class="lineno">378</span>            <span class="k">return</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">count</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">cum_strategy</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-48'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-48'>#</a>
                </div>
                <p>Clear current regrets</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">380</span>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-49'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-49'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">384</span>        <span class="bp">self</span><span class="o">.</span><span class="n">current_regret</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">()}</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-50'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-50'>#</a>
                </div>
                <p>Update regrets with current regrets</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">386</span>    <span class="k">def</span> <span class="nf">update_regrets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-51'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-51'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">390</span>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_regret</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="lineno">391</span>            <span class="bp">self</span><span class="o">.</span><span class="n">regret</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">v</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-52'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-52'>#</a>
                </div>
                <p>Human readable representation</p>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">393</span>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-53'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-53'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">397</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-54'>
        <div class='docs doc-strings'>
                <div class='section-link'>
                    <a href='#section-54'>#</a>
                </div>
                <p>
<script type="math/tex; mode=display">r^t_i(a) = \max_{\sigma^*_i} u_i(\sigma^*_i, \sigma^t_{-i}) - u_i(\sigma^t)</script>
where,</p>
<ul>
<li>$\sigma^t_i$ is the current strategy of player $i$,</li>
<li>$\sigma^t$ is the <strong>strategy profile</strong> which consists of strategies of all players
 $\sigma^t_1, \sigma^t_2, &hellip;$</li>
<li>$\sigma^t_{-i}$ is strategies of all players except $\sigma^t_i$</li>
<li>$u_i(\sigma^t)$ is the overall utility of player $i$
<script type="math/tex; mode=display">u_i(\sigma) = \sum_{h \in Z} u_i(h) \pi^\sigma(h)</script>
where $u_i(h)$ is the <a href="#terminal_utility">terminal utility</a>
and $\pi^\sigma(h)$ is the probability of $h$ occurring if players chose actions
according to $\sigma$.</li>
</ul>
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">400</span><span class="k">class</span> <span class="nc">CFR</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-55'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-55'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">415</span>    <span class="n">update_get_cfv</span><span class="p">:</span> <span class="s1">&#39;UpdateAndGetCounterFactualValue&#39;</span>
<span class="lineno">416</span>    <span class="n">track_frequency</span><span class="p">:</span> <span class="nb">int</span>
<span class="lineno">417</span>    <span class="n">info_sets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InfoSet</span><span class="p">]</span>
<span class="lineno">418</span>    <span class="n">is_online_update</span><span class="p">:</span> <span class="nb">bool</span>
<span class="lineno">419</span>    <span class="n">n_players</span><span class="p">:</span> <span class="nb">int</span>
<span class="lineno">420</span>    <span class="n">create_new_history</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">History</span><span class="p">]</span>
<span class="lineno">421</span>    <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-56'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-56'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">423</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
<span class="lineno">424</span>                 <span class="n">create_new_history</span><span class="p">,</span>
<span class="lineno">425</span>                 <span class="n">epochs</span><span class="p">,</span>
<span class="lineno">426</span>                 <span class="n">training_loop</span><span class="p">:</span> <span class="n">TrainingLoop</span><span class="p">,</span>
<span class="lineno">427</span>                 <span class="n">update_regrets</span><span class="p">:</span> <span class="s1">&#39;UpdateRegrets&#39;</span><span class="p">,</span>
<span class="lineno">428</span>                 <span class="n">update_infosets</span><span class="p">:</span> <span class="s1">&#39;UpdateInfoSets&#39;</span><span class="p">,</span>
<span class="lineno">429</span>                 <span class="n">update_average_strategy</span><span class="p">:</span> <span class="s1">&#39;UpdateAverageStrategy&#39;</span><span class="p">,</span>
<span class="lineno">430</span>                 <span class="n">update_get_cfv</span><span class="p">:</span> <span class="s1">&#39;UpdateAndGetCounterFactualValue&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="lineno">431</span>                 <span class="n">n_players</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="lineno">432</span>                 <span class="n">track_frequency</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="lineno">433</span>                 <span class="n">save_frequency</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="lineno">434</span>        <span class="bp">self</span><span class="o">.</span><span class="n">update_average_strategy</span> <span class="o">=</span> <span class="n">update_average_strategy</span>
<span class="lineno">435</span>        <span class="bp">self</span><span class="o">.</span><span class="n">training_loop</span> <span class="o">=</span> <span class="n">training_loop</span>
<span class="lineno">436</span>        <span class="k">if</span> <span class="n">update_get_cfv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="lineno">437</span>            <span class="n">update_get_cfv</span> <span class="o">=</span> <span class="n">UpdateAndGetCounterFactualValue</span><span class="p">()</span>
<span class="lineno">438</span>        <span class="bp">self</span><span class="o">.</span><span class="n">update_get_cfv</span> <span class="o">=</span> <span class="n">update_get_cfv</span>
<span class="lineno">439</span>        <span class="bp">self</span><span class="o">.</span><span class="n">update_regrets</span> <span class="o">=</span> <span class="n">update_regrets</span>
<span class="lineno">440</span>        <span class="bp">self</span><span class="o">.</span><span class="n">update_infosets</span> <span class="o">=</span> <span class="n">update_infosets</span>
<span class="lineno">441</span>        <span class="bp">self</span><span class="o">.</span><span class="n">save_frequency</span> <span class="o">=</span> <span class="n">save_frequency</span>
<span class="lineno">442</span>        <span class="bp">self</span><span class="o">.</span><span class="n">track_frequency</span> <span class="o">=</span> <span class="n">track_frequency</span>
<span class="lineno">443</span>        <span class="bp">self</span><span class="o">.</span><span class="n">n_players</span> <span class="o">=</span> <span class="n">n_players</span>
<span class="lineno">444</span>        <span class="bp">self</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="n">epochs</span>
<span class="lineno">445</span>        <span class="bp">self</span><span class="o">.</span><span class="n">create_new_history</span> <span class="o">=</span> <span class="n">create_new_history</span>
<span class="lineno">446</span>        <span class="bp">self</span><span class="o">.</span><span class="n">info_sets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="lineno">447</span>        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span> <span class="o">=</span> <span class="n">InfoSetTracker</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-57'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-57'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">449</span>    <span class="k">def</span> <span class="nf">cfr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">History</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Player</span><span class="p">,</span> <span class="n">pi_i</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pi_neg_i</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="lineno">450</span>        <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">():</span>
<span class="lineno">451</span>            <span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">terminal_utility</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="lineno">452</span>        <span class="k">elif</span> <span class="n">h</span><span class="o">.</span><span class="n">is_chance</span><span class="p">():</span>
<span class="lineno">453</span>            <span class="n">a</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">sample_chance</span><span class="p">()</span>
<span class="lineno">454</span>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfr</span><span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">pi_i</span><span class="p">,</span> <span class="n">pi_neg_i</span><span class="p">)</span>
<span class="lineno">455</span>
<span class="lineno">456</span>        <span class="n">info_set_key</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">info_set_key</span><span class="p">()</span>
<span class="lineno">457</span>        <span class="k">if</span> <span class="n">info_set_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_sets</span><span class="p">:</span>
<span class="lineno">458</span>            <span class="bp">self</span><span class="o">.</span><span class="n">info_sets</span><span class="p">[</span><span class="n">info_set_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">new_info_set</span><span class="p">()</span>
<span class="lineno">459</span>        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_sets</span><span class="p">[</span><span class="n">info_set_key</span><span class="p">]</span>
<span class="lineno">460</span>        <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
<span class="lineno">461</span>        <span class="n">va</span> <span class="o">=</span> <span class="p">{}</span>
<span class="lineno">462</span>
<span class="lineno">463</span>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">I</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
<span class="lineno">464</span>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">h</span><span class="o">.</span><span class="n">player</span><span class="p">():</span>
<span class="lineno">465</span>                <span class="n">va</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfr</span><span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">pi_i</span> <span class="o">*</span> <span class="n">I</span><span class="o">.</span><span class="n">strategy</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">pi_neg_i</span><span class="p">)</span>
<span class="lineno">466</span>            <span class="k">else</span><span class="p">:</span>
<span class="lineno">467</span>                <span class="n">va</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfr</span><span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">pi_i</span><span class="p">,</span> <span class="n">pi_neg_i</span> <span class="o">*</span> <span class="n">I</span><span class="o">.</span><span class="n">strategy</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
<span class="lineno">468</span>            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="n">I</span><span class="o">.</span><span class="n">strategy</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">*</span> <span class="n">va</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="lineno">469</span>
<span class="lineno">470</span>        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_get_cfv</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="lineno">471</span>
<span class="lineno">472</span>        <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">player</span><span class="p">()</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
<span class="lineno">473</span>            <span class="bp">self</span><span class="o">.</span><span class="n">update_average_strategy</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">pi_i</span><span class="p">)</span>
<span class="lineno">474</span>            <span class="bp">self</span><span class="o">.</span><span class="n">update_regrets</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">pi_neg_i</span><span class="p">)</span>
<span class="lineno">475</span>
<span class="lineno">476</span>        <span class="k">return</span> <span class="n">v</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-58'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-58'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">478</span>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">479</span>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_loop</span><span class="p">:</span>
<span class="lineno">480</span>            <span class="bp">self</span><span class="o">.</span><span class="n">update_infosets</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_sets</span><span class="p">)</span>
<span class="lineno">481</span>
<span class="lineno">482</span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_players</span><span class="p">):</span>
<span class="lineno">483</span>                <span class="bp">self</span><span class="o">.</span><span class="n">cfr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_history</span><span class="p">(),</span> <span class="n">cast</span><span class="p">(</span><span class="n">Player</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">484</span>
<span class="lineno">485</span>            <span class="bp">self</span><span class="o">.</span><span class="n">update_infosets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_sets</span><span class="p">)</span>
<span class="lineno">486</span>
<span class="lineno">487</span>            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_sets</span><span class="p">)</span>
<span class="lineno">488</span>
<span class="lineno">489</span>            <span class="bp">self</span><span class="o">.</span><span class="n">update_get_cfv</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<span class="lineno">490</span>
<span class="lineno">491</span>        <span class="n">logger</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_sets</span><span class="p">)</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-59'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-59'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">494</span><span class="k">class</span> <span class="nc">UpdateRegrets</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-60'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-60'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">495</span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="p">:</span> <span class="n">InfoSet</span><span class="p">,</span> <span class="n">va</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">v</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pi_neg_i</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="lineno">496</span>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">I</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
<span class="lineno">497</span>            <span class="n">I</span><span class="o">.</span><span class="n">regret</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pi_neg_i</span> <span class="o">*</span> <span class="p">(</span><span class="n">va</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span>
<span class="lineno">498</span>
<span class="lineno">499</span>        <span class="n">I</span><span class="o">.</span><span class="n">calculate_strategy</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-61'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-61'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">502</span><span class="k">class</span> <span class="nc">UpdateInfoSets</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-62'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-62'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">503</span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_sets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InfoSet</span><span class="p">]):</span>
<span class="lineno">504</span>        <span class="k">pass</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-63'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-63'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">506</span>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_sets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InfoSet</span><span class="p">]):</span>
<span class="lineno">507</span>        <span class="k">pass</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-64'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-64'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">510</span><span class="k">class</span> <span class="nc">OfflineUpdateRegrets</span><span class="p">(</span><span class="n">UpdateRegrets</span><span class="p">):</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-65'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-65'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">511</span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="p">:</span> <span class="n">InfoSet</span><span class="p">,</span> <span class="n">va</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">v</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pi_neg_i</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="lineno">512</span>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">I</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
<span class="lineno">513</span>            <span class="n">I</span><span class="o">.</span><span class="n">current_regret</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pi_neg_i</span> <span class="o">*</span> <span class="p">(</span><span class="n">va</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-66'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-66'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">516</span><span class="k">class</span> <span class="nc">OfflineUpdateInfoSets</span><span class="p">(</span><span class="n">UpdateInfoSets</span><span class="p">):</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-67'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-67'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">517</span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_sets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InfoSet</span><span class="p">]):</span>
<span class="lineno">518</span>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">info_sets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="lineno">519</span>            <span class="n">I</span><span class="o">.</span><span class="n">update_regrets</span><span class="p">()</span>
<span class="lineno">520</span>            <span class="n">I</span><span class="o">.</span><span class="n">calculate_strategy</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-68'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-68'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">522</span>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_sets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InfoSet</span><span class="p">]):</span>
<span class="lineno">523</span>        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">info_sets</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<span class="lineno">524</span>            <span class="n">I</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-69'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-69'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">527</span><span class="k">class</span> <span class="nc">UpdateAndGetCounterFactualValue</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-70'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-70'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">528</span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">History</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Player</span><span class="p">):</span>
<span class="lineno">529</span>        <span class="k">return</span> <span class="n">v</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-71'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-71'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">531</span>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">532</span>        <span class="k">pass</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-72'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-72'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">535</span><span class="k">class</span> <span class="nc">UpdateAverageStrategy</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-73'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-73'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">536</span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="p">:</span> <span class="n">InfoSet</span><span class="p">,</span> <span class="n">pi_i</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="lineno">537</span>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">I</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
<span class="lineno">538</span>            <span class="n">I</span><span class="o">.</span><span class="n">average_strategy</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">average_strategy</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+</span> <span class="n">pi_i</span> <span class="o">*</span> <span class="n">I</span><span class="o">.</span><span class="n">strategy</span><span class="p">[</span><span class="n">a</span><span class="p">]</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-74'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-74'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">541</span><span class="k">class</span> <span class="nc">InfoSetTracker</span><span class="p">:</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-75'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-75'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">542</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">543</span>        <span class="n">tracker</span><span class="o">.</span><span class="n">set_histogram</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;strategy.*&#39;</span><span class="p">)</span>
<span class="lineno">544</span>        <span class="n">tracker</span><span class="o">.</span><span class="n">set_histogram</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;average_strategy.*&#39;</span><span class="p">)</span>
<span class="lineno">545</span>        <span class="n">tracker</span><span class="o">.</span><span class="n">set_histogram</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;regret.*&#39;</span><span class="p">)</span>
<span class="lineno">546</span>        <span class="n">tracker</span><span class="o">.</span><span class="n">set_histogram</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;current_regret.*&#39;</span><span class="p">)</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-76'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-76'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">548</span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_sets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InfoSet</span><span class="p">]):</span>
<span class="lineno">549</span>        <span class="k">with</span> <span class="n">monit</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s2">&quot;Track&quot;</span><span class="p">):</span>
<span class="lineno">550</span>            <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">info_sets</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<span class="lineno">551</span>                <span class="n">avg_strategy</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">get_average_strategy</span><span class="p">()</span>
<span class="lineno">552</span>                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">I</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
<span class="lineno">553</span>                    <span class="n">tracker</span><span class="o">.</span><span class="n">add</span><span class="p">({</span>
<span class="lineno">554</span>                        <span class="sa">f</span><span class="s1">&#39;strategy.</span><span class="si">{</span><span class="n">I</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">I</span><span class="o">.</span><span class="n">strategy</span><span class="p">[</span><span class="n">a</span><span class="p">],</span>
<span class="lineno">555</span>                        <span class="sa">f</span><span class="s1">&#39;average_strategy.</span><span class="si">{</span><span class="n">I</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">avg_strategy</span><span class="p">[</span><span class="n">a</span><span class="p">],</span>
<span class="lineno">556</span>                        <span class="sa">f</span><span class="s1">&#39;regret.</span><span class="si">{</span><span class="n">I</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">I</span><span class="o">.</span><span class="n">regret</span><span class="p">[</span><span class="n">a</span><span class="p">],</span>
<span class="lineno">557</span>                        <span class="sa">f</span><span class="s1">&#39;current_regret.</span><span class="si">{</span><span class="n">I</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">I</span><span class="o">.</span><span class="n">current_regret</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="lineno">558</span>                    <span class="p">})</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-77'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-77'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">561</span><span class="k">class</span> <span class="nc">CFRConfigs</span><span class="p">(</span><span class="n">BaseConfigs</span><span class="p">):</span>
<span class="lineno">562</span>    <span class="n">update_regrets</span><span class="p">:</span> <span class="n">UpdateRegrets</span>
<span class="lineno">563</span>    <span class="n">update_infosets</span><span class="p">:</span> <span class="n">UpdateInfoSets</span>
<span class="lineno">564</span>    <span class="n">create_new_history</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">History</span><span class="p">]</span>
<span class="lineno">565</span>    <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1_00_000</span>
<span class="lineno">566</span>    <span class="n">update_get_cfv</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UpdateAndGetCounterFactualValue</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="lineno">567</span>    <span class="n">track_frequency</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1_000</span>
<span class="lineno">568</span>    <span class="n">save_frequency</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1_000</span>
<span class="lineno">569</span>    <span class="n">cfr</span><span class="p">:</span> <span class="n">CFR</span> <span class="o">=</span> <span class="s1">&#39;simple_cfr&#39;</span>
<span class="lineno">570</span>    <span class="n">loop</span><span class="p">:</span> <span class="n">TrainingLoop</span>
<span class="lineno">571</span>    <span class="n">update_average_strategy</span><span class="p">:</span> <span class="n">UpdateAverageStrategy</span></pre></div>
            </div>
        </div>
    <div class='section' id='section-78'>
            <div class='docs'>
                <div class='section-link'>
                    <a href='#section-78'>#</a>
                </div>
                
            </div>
            <div class='code'>
                <div class="highlight"><pre><span class="lineno">574</span><span class="nd">@option</span><span class="p">(</span><span class="n">CFRConfigs</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
<span class="lineno">575</span><span class="k">def</span> <span class="nf">training_loop</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">CFRConfigs</span><span class="p">):</span>
<span class="lineno">576</span>    <span class="k">return</span> <span class="n">TrainingLoop</span><span class="p">(</span>
<span class="lineno">577</span>        <span class="n">loop_count</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span>
<span class="lineno">578</span>        <span class="n">loop_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="lineno">579</span>        <span class="n">is_save_models</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="lineno">580</span>        <span class="n">log_new_line_interval</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">track_frequency</span><span class="p">,</span>
<span class="lineno">581</span>        <span class="n">log_write_interval</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">track_frequency</span><span class="p">,</span>
<span class="lineno">582</span>        <span class="n">save_models_interval</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">save_frequency</span><span class="p">,</span>
<span class="lineno">583</span>        <span class="n">is_loop_on_interrupt</span><span class="o">=</span><span class="kc">True</span>
<span class="lineno">584</span>    <span class="p">)</span>
<span class="lineno">585</span>
<span class="lineno">586</span>
<span class="lineno">587</span><span class="nd">@option</span><span class="p">(</span><span class="n">CFRConfigs</span><span class="o">.</span><span class="n">cfr</span><span class="p">)</span>
<span class="lineno">588</span><span class="k">def</span> <span class="nf">simple_cfr</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">CFRConfigs</span><span class="p">):</span>
<span class="lineno">589</span>    <span class="k">return</span> <span class="n">CFR</span><span class="p">(</span><span class="n">create_new_history</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">create_new_history</span><span class="p">,</span>
<span class="lineno">590</span>               <span class="n">epochs</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span>
<span class="lineno">591</span>               <span class="n">training_loop</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span>
<span class="lineno">592</span>               <span class="n">update_get_cfv</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">update_get_cfv</span><span class="p">,</span>
<span class="lineno">593</span>               <span class="n">track_frequency</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">track_frequency</span><span class="p">,</span>
<span class="lineno">594</span>               <span class="n">save_frequency</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">save_frequency</span><span class="p">,</span>
<span class="lineno">595</span>               <span class="n">update_average_strategy</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">update_average_strategy</span><span class="p">,</span>
<span class="lineno">596</span>               <span class="n">update_regrets</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">update_regrets</span><span class="p">,</span>
<span class="lineno">597</span>               <span class="n">update_infosets</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">update_infosets</span><span class="p">)</span>
<span class="lineno">598</span>
<span class="lineno">599</span>
<span class="lineno">600</span><span class="nd">@option</span><span class="p">(</span><span class="n">CFRConfigs</span><span class="o">.</span><span class="n">update_regrets</span><span class="p">,</span> <span class="s1">&#39;online&#39;</span><span class="p">)</span>
<span class="lineno">601</span><span class="k">def</span> <span class="nf">online_update_regrets</span><span class="p">():</span>
<span class="lineno">602</span>    <span class="k">return</span> <span class="n">UpdateRegrets</span><span class="p">()</span>
<span class="lineno">603</span>
<span class="lineno">604</span>
<span class="lineno">605</span><span class="nd">@option</span><span class="p">(</span><span class="n">CFRConfigs</span><span class="o">.</span><span class="n">update_infosets</span><span class="p">,</span> <span class="s1">&#39;online&#39;</span><span class="p">)</span>
<span class="lineno">606</span><span class="k">def</span> <span class="nf">online_update_infosets</span><span class="p">():</span>
<span class="lineno">607</span>    <span class="k">return</span> <span class="n">UpdateInfoSets</span><span class="p">()</span>
<span class="lineno">608</span>
<span class="lineno">609</span>
<span class="lineno">610</span><span class="nd">@option</span><span class="p">(</span><span class="n">CFRConfigs</span><span class="o">.</span><span class="n">update_regrets</span><span class="p">,</span> <span class="s1">&#39;offline&#39;</span><span class="p">)</span>
<span class="lineno">611</span><span class="k">def</span> <span class="nf">offline_update_regrets</span><span class="p">():</span>
<span class="lineno">612</span>    <span class="k">return</span> <span class="n">OfflineUpdateRegrets</span><span class="p">()</span>
<span class="lineno">613</span>
<span class="lineno">614</span>
<span class="lineno">615</span><span class="nd">@option</span><span class="p">(</span><span class="n">CFRConfigs</span><span class="o">.</span><span class="n">update_infosets</span><span class="p">,</span> <span class="s1">&#39;offline&#39;</span><span class="p">)</span>
<span class="lineno">616</span><span class="k">def</span> <span class="nf">offline_update_infosets</span><span class="p">():</span>
<span class="lineno">617</span>    <span class="k">return</span> <span class="n">OfflineUpdateInfoSets</span><span class="p">()</span>
<span class="lineno">618</span>
<span class="lineno">619</span>
<span class="lineno">620</span><span class="nd">@option</span><span class="p">(</span><span class="n">CFRConfigs</span><span class="o">.</span><span class="n">update_average_strategy</span><span class="p">)</span>
<span class="lineno">621</span><span class="k">def</span> <span class="nf">simple_update_average_strategy</span><span class="p">():</span>
<span class="lineno">622</span>    <span class="k">return</span> <span class="n">UpdateAverageStrategy</span><span class="p">()</span></pre></div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML">
</script>
<!-- MathJax configuration -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'] ],
            displayMath: [ ['$$','$$'] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": { fonts: ["TeX"] }
    });
</script>
<script>
    function handleImages() {
        var images = document.querySelectorAll('p>img')

        console.log(images);
        for (var i = 0; i < images.length; ++i) {
            handleImage(images[i])
        }
    }

    function handleImage(img) {
        img.parentElement.style.textAlign = 'center'

        var modal = document.createElement('div')
        modal.id = 'modal'

        var modalContent = document.createElement('div')
        modal.appendChild(modalContent)

        var modalImage = document.createElement('img')
        modalContent.appendChild(modalImage)

        var span = document.createElement('span')
        span.classList.add('close')
        span.textContent = 'x'
        modal.appendChild(span)

        img.onclick = function () {
            console.log('clicked')
            document.body.appendChild(modal)
            modalImage.src = img.src
        }

        span.onclick = function () {
            document.body.removeChild(modal)
        }
    }

    handleImages()
</script>
</body>
</html>